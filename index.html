<!DOCTYPE html>
<html>
<meta charset="utf-8">

<svg width="960" height="600"></svg>
<?php Header("Cache-Control: max-age=3000, must-revalidate"); ?>

<script src="https://d3js.org/d3.v5.min.js"></script>

<script>

Promise.all([
  d3.csv("data/nodes.csv"),
  d3.csv("data/links.csv"),
]).then(function(data) {
  var nodes_data = data[0]
  var links_data = data[1]

  var width = window.innerWidth
  var height = window.innerHeight

  var svg = d3.select('svg')
  svg.attr('width', width).attr('height', height)

  // simulation setup with all forces
  var simulation = d3
    .forceSimulation()
    .force('charge', d3.forceManyBody().strength(-120))
    .force('center', d3.forceCenter(width / 2, height / 2))

  function getNodeColor(node) {
    if (node.type == 0) {
      return node.percentchangeinstockprice > 0 ? 'blue' : 'yellow'
    }
    return node.candidatewinlost === 0 ? 'red' : 'green'
  }

  var nodes = svg.append("g")
    .attr("class", "nodes")
    .selectAll("circle")
    .data(nodes_data)
    .enter().append("circle")
      .attr("r", "20")
      .attr("fill", getNodeColor)

  var text = svg.append("g")
    .attr("class", "text")
    .selectAll("text")
    .data(nodes_data)
    .enter().append("text")
      .text(function (node) { return  node.label })
  	  .attr("font-size", 5)
      .attr("color", 'black')
  	  .attr("dx", 5)
      .attr("dy", 2)

  simulation.nodes(nodes_data).on('tick', () => {
    nodes
      .attr('cx', function (node) { return node.x })
      .attr('cy', function (node) { return node.y })
    text
      .attr('x', function (node) { return node.x })
      .attr('y', function (node) { return node.y })
  })

  // simulation.nodes(rep_data).on('tick', () => {
  //   rep_nodes
  //     .attr('cx', function (node) { return node.x })
  //     .attr('cy', function (node) { return node.y })
  //   text
  //     .attr('x', function (node) { return node.x })
  //     .attr('y', function (node) { return node.y })
  // })
})

</script>
</html>
